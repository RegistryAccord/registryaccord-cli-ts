# docker-compose.yml
version: "3.8"

services:
  ra:
    build: .
    image: registryaccord/cli:dev
    container_name: ra
    env_file:
      - .env
    environment:
      - RA_IDENTITY_BASE_URL=${RA_IDENTITY_BASE_URL-http://localhost:8081}
      - RA_CDV_BASE_URL=${RA_CDV_BASE_URL-http://localhost:8082}
      - RA_GATEWAY_BASE_URL=${RA_GATEWAY_BASE_URL-http://localhost:8083}
      - RA_ENV=${RA_ENV-development}
      - RA_OUTPUT=${RA_OUTPUT-table}
    volumes:
      - ~/.registryaccord:/home/node/.registryaccord
      - .:/workspace
    working_dir: /workspace
    depends_on:
      - nats
      - db

  nats:
    image: nats:latest
    container_name: nats
    ports:
      - "4222:4222"
      - "8222:8222"

  db:
    image: postgres:16-alpine
    container_name: registryaccord-db
    environment:
      - POSTGRES_USER=registryaccord
      - POSTGRES_PASSWORD=registryaccord
      - POSTGRES_DB=registryaccord
    ports:
      - "5432:5432"
    volumes:
      - pgdata:/var/lib/postgresql/data

volumes:
  pgdata:
